{% load static %}
{% include 'navbar.html' %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/users.css' %}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <title>Users</title>
  
   <style>
    body {
        font-family: 'Helvetica Neue', Arial, sans-serif !important;
        background-color: #f0f4f8 !important;
        color: #444 !important;
        line-height: 1.6 !important;
    }
    
    .container {
        max-width: 1200px !important;
        margin: 40px auto !important;
        padding: 30px !important;
        background-color: #ffffff !important;
        border-radius: 12px !important;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1) !important;
    }
    
    .header-container {
        display: flex !important;
        justify-content: space-between !important;
        align-items: center !important;
        margin-bottom: 30px !important;
    }
    
    .header-container h1 {
        font-size: 32px !important;
        color: #007bff !important;
        margin: 0 !important;
    }
    
    button {
        background-color: #007bff !important;
        color: #fff !important;
        border: none !important;
        padding: 8px 15px !important;
        border-radius: 6px !important;
        cursor: pointer !important;
        transition: background-color 0.3s !important;
        font-size: 14px !important;
    }
    
    button:hover {
        background-color: #0056b3 !important;
    }
    
    table {
        width: 100% !important;
        border-collapse: collapse !important;
        margin-top: 20px !important;
    }
    
    th,
    td {
        padding: 15px !important;
        text-align: left !important;
        border-bottom: 1px solid #dee2e6 !important;
    }
    
    th {
        background-color: #007bff !important;
        color: #ffffff !important;
        font-weight: bold !important;
    }
    
    tr:nth-child(even) {
        background-color: #f8f9fa !important;
    }
    
    tr:hover {
        background-color: #e9ecef !important;
    }
    
    #add-user-modal {
        position: fixed !important;
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        padding: 30px !important;
        background-color: #ffffff !important;
        border-radius: 10px !important;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2) !important;
        z-index: 1000 !important;
        width: 90% !important;
        max-width: 400px !important;
    }
    
    #add-user-form {
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
    }
    
    #add-user-form label {
        margin-top: 15px !important;
        font-weight: bold !important;
    }
    
    #add-user-form input,
    #add-user-form select {
        padding: 12px !important;
        margin-top: 5px !important;
        border: 1px solid #ced4da !important;
        border-radius: 6px !important;
        width: 100%;
    }
    
    #result-message {
        margin-top: 20px !important;
        font-weight: bold !important;
        color: #28a745 !important;
    }
    
    #button-container {
        display: flex !important;
        justify-content: space-between !important;
    }
    
    #add-user-form button[type="submit"],
    #add-user-form button[type="button"] {
        width: 48% !important;
        margin: 5px 1% !important;
    }
    
    @media (max-width: 768px) {
        .container {
            width: 90%;
            padding: 15px;
        }
    
        .header-container {
            flex-direction: column;
            margin-bottom: 15px;
        }
    
        .header-container h1 {
            font-size: 20px;
        }
    
        th,
        td {
            padding: 10px;
            font-size: 12px;
            text-align: center;
        }
    
        #add-user-form button[type="submit"],
        #add-user-form button[type="button"] {
            width: 100%;
            margin: 5px 0;
            padding: 10px;
            font-size: 12px;
        }
    
        #result-message {
            text-align: center;
            font-size: 12px;
        }
    
        #add-user-form input,
        #add-user-form select {
            width: 100%;
            font-size: 12px;
        }
    }
    

</style>
</head>
<body>
    <div class="container">
        <div id="result-message">{{ message }}</div>
        <div class="header-container">
            <h1>Users</h1>
            <button id="add-user-btn">Add User</button>
        </div>

        <div id="user-list">
            <table>
                <thead>
                    <tr>
                        <th>User Name</th>
                        <th>User Email</th>
                        <th>User Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr id="user-{{ user.id }}">
                        <td>{{ user.username }}</td>
                        <td>{{ user.email }}</td>
                        <td>
                            {% if user.is_active %}
                                Active
                            {% else %}
                                Inactive
                            {% endif %}
                        </td>
                        <td><button class="remove-btn" data-id="{{ user.id }}">✖</button></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Add User Modal -->
        <div id="add-user-modal" style="display:none;">
            <h2>Add User</h2>
            <form id="add-user-form">
                <label for="username">User Name:</label>
                <input type="text" id="username" name="username" required>

                <label for="email">User Email:</label>
                <input type="email" id="email" name="email" required>

                <label for="is_active">User Status:</label>
                <select id="is_active" name="is_active">
                    <option value="True">Active</option>
                    <option value="False">Inactive</option>
                </select>

                <button type="submit">Add User</button>
                <button type="button" id="close-modal">Cancel</button>
            </form>
        </div>
    </div>

<script>
$(document).ready(function() {
    // Show the add user modal when the button is clicked
    $('#add-user-btn').on('click', function() {
        $('#add-user-modal').show();
    });

    // Close the modal
    $('#close-modal').on('click', function() {
        $('#add-user-modal').hide();
    });

    // Handle form submission for adding a new user
    $('#add-user-form').on('submit', function(e) {
        e.preventDefault(); // Prevent default form submission
        const formData = $(this).serialize(); // Serialize form data

        $.ajax({
            type: 'POST',
            url: '{% url "add_user" %}', // Ensure the URL is correctly set up in urls.py
            data: formData,
            headers: {
                'X-CSRFToken': '{{ csrf_token }}' // Ensure CSRF token is included
            },
            success: function(response) {
                // Append new user to the table
                $('#user-list tbody').append(`
                    <tr id="user-${response.user_id}">
                        <td>${response.username}</td>
                        <td>${response.email}</td>
                        <td>${response.is_active ? 'Active' : 'Inactive'}</td>
                        <td><button class="remove-btn" data-id="${response.user_id}">✖</button></td>
                    </tr>
                `);
                $('#add-user-modal').hide(); // Hide the modal
                $('#add-user-form')[0].reset(); // Reset the form
                $('#result-message').text(response.message); // Display success message
            },
            error: function(xhr) {
                $('#result-message').text(xhr.responseJSON.message); // Display error message
            }
        });
    });

    // Handle user removal (logout)
    $(document).on('click', '.remove-btn', function() {
        const userId = $(this).data('id');

        if (confirm("Are you sure you want to log out this user?")) {
            $.ajax({
                type: 'POST',
                url: '{% url "remove_user" %}', // Ensure the URL is correctly set up in urls.py
                data: {
                    'user_id': userId,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'  // Include CSRF token
                },
                success: function(response) {
                    // Remove the user row from the table
                    $(`#user-${userId}`).remove();
                    $('#result-message').text(response.message); // Display success message
                },
                error: function(xhr) {
                    $('#result-message').text(xhr.responseJSON.message); // Display error message
                }
            });
        }
    });
});
</script>

</body>
</html>
